'use strict';(function(h,k){"object"===typeof exports&&"undefined"!==typeof module?module.exports=k():"function"===typeof define&&define.amd?define(k):(h=h||self,h.ShaderPen=k())})(this,function(){function h(f,a){for(var d=0;d<a.length;d++){var b=a[d];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(f,b.key,b)}}function k(f,a,d){a&&h(f.prototype,a);d&&h(f,d);return f}return function(){function f(a,d){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");
var b=/\(\s*out\s+vec4\s+(\S+)\s*,\s*in\s+vec2\s+(\S+)\s*\)/,e=a.match(b);a=a.replace("mainImage","main");a=a.replace(b,"()");var l=this.uniforms={iResolution:{type:"vec3",value:[window.innerWidth,window.innerHeight,0]},iTime:{type:"float",value:0},iTimeDelta:{type:"float",value:0},iFrame:{type:"int",value:0},iMouse:{type:"vec4",value:[0,0,0,0]}};a=(e?"#define ".concat(e[1]," gl_FragColor\n#define ").concat(e[2]," gl_FragCoord.xy\n"):"")+a;a=Object.keys(l).map(function(a){return{name:a,type:l[a].type}}).reduce(function(a,
b){return a+"uniform ".concat(b.type," ").concat(b.name,";\n")},"")+a;a="precision highp float;\n"+a;b=this.canvas=document.createElement("canvas");b.width=window.innerWidth;b.height=window.innerHeight;b.style.position="fixed";b.style.zIndex=-1;b.style.left=0;b.style.top=0;document.body.append(b);var c=this.gl=b.getContext("webgl");c.clearColor(0,0,0,0);b=this.vertexShader=c.createShader(c.VERTEX_SHADER);c.shaderSource(b,"\n      attribute vec2 position;\n      void main() {\n      gl_Position = vec4(position, 0.0, 1.0);\n      }\n    ");
c.compileShader(b);e=this.fragmentShader=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(e,a);c.compileShader(e);var g=this.program=c.createProgram();c.attachShader(g,b);c.attachShader(g,e);c.linkProgram(g);a=this.vertices=new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]);b=this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,b);c.bufferData(c.ARRAY_BUFFER,a,c.STATIC_DRAW);c.useProgram(g);g.position=c.getAttribLocation(g,"position");c.enableVertexAttribArray(g.position);c.vertexAttribPointer(g.position,
2,c.FLOAT,!1,0,0);Object.keys(l).forEach(function(a,b){l[a].location=c.getUniformLocation(g,a)});this.reportErrors();this._bind("mouseDown","mouseMove","mouseUp","render","resize");window.addEventListener("mousedown",this.mouseDown);window.addEventListener("mousemove",this.mouseMove);window.addEventListener("mouseup",this.mouseUp);window.addEventListener("resize",this.resize);"NO_RENDER"!==d&&this.render()}k(f,[{key:"_bind",value:function(){for(var a=this,d=arguments.length,b=Array(d),e=0;e<d;e++)b[e]=
arguments[e];b.forEach(function(b){return a[b]=a[b].bind(a)})}},{key:"mouseDown",value:function(a){this.mousedown=!0;this.uniforms.iMouse.value[2]=a.clientX;this.uniforms.iMouse.value[3]=a.clientY}},{key:"mouseMove",value:function(a){this.mousedown&&(this.uniforms.iMouse.value[0]=a.clientX,this.uniforms.iMouse.value[1]=a.clientY)}},{key:"mouseUp",value:function(a){this.mousedown=!1;this.uniforms.iMouse.value[2]=0;this.uniforms.iMouse.value[3]=0}},{key:"render",value:function(a){var d=this,b=this.gl,
e=this.lastTime?(a-this.lastTime)/1E3:0;this.lastTime=a;this.uniforms.iTime.value+=e;this.uniforms.iTimeDelta.value=e;this.uniforms.iFrame.value++;b.clear(b.COLOR_BUFFER_BIT);Object.keys(this.uniforms).forEach(function(a){var c=d.uniforms[a].type;c=c.match(/vec/)?"".concat(c[c.length-1],"fv"):"1".concat(c[0]);b["uniform".concat(c)](d.uniforms[a].location,d.uniforms[a].value)});b.drawArrays(b.TRIANGLES,0,this.vertices.length/2);requestAnimationFrame(this.render)}},{key:"reportErrors",value:function(){var a=
this.gl;a.getShaderParameter(this.vertexShader,a.COMPILE_STATUS)||console.log(a.getShaderInfoLog(this.vertexShader));a.getShaderParameter(this.fragmentShader,a.COMPILE_STATUS)||console.log(a.getShaderInfoLog(this.fragmentShader));a.getProgramParameter(this.program,a.LINK_STATUS)||console.log(a.getProgramInfoLog(this.program))}},{key:"resize",value:function(){this.canvas.width=this.uniforms.iResolution.value[0]=window.innerWidth;this.canvas.height=this.uniforms.iResolution.value[1]=window.innerHeight;
this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}}]);return f}()});